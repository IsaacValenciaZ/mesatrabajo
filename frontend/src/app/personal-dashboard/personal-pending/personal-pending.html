<div class="view-section fade-in">
  <div class="section-header">
    <div>
      <h1>Mis Asignaciones</h1>
      <p>Tickets pendientes de atención.</p>
    </div>
    <div class="big-counter">
      <span class="number">{{ ticketsPendientes.length }}</span>
      <span class="label">Pendientes</span>
    </div>
  </div>

  <div class="table-card">
    <div class="table-responsive">
      <table class="simple-table">
        <thead>
          <tr>
            <th>#ID</th>
            <th>Fecha Solicitud</th>
            <th>Vencimiento</th> 
            <th>Solicitante</th>
            <th>Departamento</th>
            <th>Problema</th>
            <th>Prioridad</th>
            <th class="text-center">Notas</th>
            <th class="text-center">Estado</th>
            <th class="text-center">Acción</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let t of ticketsPendientes">
             <td><strong>#{{ t.id }}</strong></td>
             
             <td class="time-col">{{ t.fecha | date:'dd/MM/yyyy' }}</td>

             <td class="time-col">
                <div style="font-size: 0.9rem; margin-bottom: 4px;">
                   {{ t.fecha_limite ? (t.fecha_limite | date:'dd/MM HH:mm') : 'N/A' }}
                </div>
                
                <span *ngIf="esVencido(t.fecha_limite)" class="badge-status late">
                    Vencido
                </span>
                <span *ngIf="t.fecha_limite && !esVencido(t.fecha_limite)" class="badge-status pending">
                    En curso
                </span>
             </td>

             <td>{{ t.nombre_usuario }}</td>
             
             <td class="depto-col">{{ t.departamento }}</td>
             
             <td>
                  <span class="badge" [ngClass]="{
                      'cat-internet': t.descripcion === 'Internet', 
                      'cat-office': t.descripcion === 'Office', 
                      'cat-telefonia': t.descripcion === 'Telefonia', 
                      'cat-tecnico': t.descripcion === 'Tecnico',
                      'cat-dictaminar': t.descripcion === 'Dictaminar',
                      'cat-extension': t.descripcion === 'Extension/Telefono',
                      'cat-correo': t.descripcion === 'Correo'
                  }">
                      {{ t.descripcion }}
                  </span>

                  <span *ngIf="t.descripcion === 'Dictaminar' && t.cantidad_dicta" class="qty-badge" style="margin-top: 5px; display: block;">
                      EQ: {{ t.cantidad_dicta }}
                  </span>
                  
                  <span *ngIf="t.descripcion === 'Extension/Telefono' && t.extension_tel" class="qty-badge" style="margin-top: 5px; display: block;">
                      Num: {{ t.extension_tel }}
                  </span>

                  <span *ngIf="t.descripcion === 'Correo' && t.correo_tipo" class="qty-badge" style="margin-top: 5px; display: block;">
                      Dom: {{ t.correo_tipo }}
                  </span>

                  <span *ngIf="t.descripcion === 'Tecnico' && t.soporte_tipo" class="qty-badge" style="margin-top: 5px; display: block; white-space: normal; line-height: 1.2;">
                      {{ t.soporte_tipo }}
                  </span>
              </td>

             <td>
                 <span class="badge" [ngClass]="{'prio-alta': t.prioridad === 'Alta', 'prio-media': t.prioridad === 'Media', 'prio-baja': t.prioridad === 'Baja'}">
                     {{ t.prioridad }}
                 </span>
             </td>
             
             <td class="text-center">
                 <button *ngIf="t.notas" class="btn-icon-small" (click)="verNotaCompleta(t.notas)"><span class="material-symbols-outlined icon">read_more</span></button>
                 <span *ngIf="!t.notas">-</span>
             </td>
             
             <td class="text-center">
               <span class="badge" [ngClass]="{
                 'status-espera': t.estado === 'En espera',
                 'status-incompleto': t.estado === 'Incompleto'
               }">{{ t.estado }}</span>
             </td>
             
             <td class="text-center"><button class="btn-action" (click)="cambiarEstado(t)"> Completar</button></td>
          </tr>
          <tr *ngIf="ticketsPendientes.length === 0 && !cargando">
            <td colspan="10" class="empty-state">  No tienes tickets pendientes.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>